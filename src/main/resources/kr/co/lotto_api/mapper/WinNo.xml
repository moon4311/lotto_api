<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.lotto_api.mapper.WinNo">
 
 	<sql id="tblnm">notice_tb</sql>
 	
 	<!-- 한건 조회 -->
 	<select id="selectOne" parameterType="map" resultType="kr.co.lotto_api.model.WinNoVO">
		SELECT 
			NOTICE_SEQ,
			SUBJECT,
			CONTENTS,
			NOTICE_TYPE_CD,
			GROUP_CONCAT(
				ATT.FILE_SEQ,
				',',
				ATT.LOGICAL_FILE_NAME
			) AS FILE_LIST,
			NT.FILE_NO,
			date_format(NT.REGIST_DATE, '%Y-%m-%d') as REGIST_DATE,
			NT.REGIST_ID,
			date_format(NT.UPDATE_DATE, '%Y-%m-%d') as UPDATE_DATE,
			NT.UPDATE_ID
		FROM <include refid="tblnm" /> NT
		LEFT JOIN ${plinkName}.ATTACH_TB ATT
		ON NT.FILE_NO = ATT.FILE_NO
		WHERE NOTICE_SEQ= #{noticeSeq}
	</select>
	
	
 	<!-- 다건 조회 -->
 	<select id="selectList" parameterType="map" resultType="kr.co.lotto_api.model.WinNoVO">
		SELECT 
			NOTICE_SEQ,
			SUBJECT,
			CONTENTS,
			CCT.CODE_NAME AS NOTICE_TYPE_NAME,
			NOTICE_TYPE_CD,
			FILE_NO,
			date_format(NT.REGIST_DATE, '%Y-%m-%d') as REGIST_DATE,
			NT.REGIST_ID	
		FROM <include refid="tblnm" /> NT
		LEFT JOIN ${plinkName}.COMMON_CODE_TB CCT
		ON NT.NOTICE_TYPE_CD = CCT.COMMON_CD
		WHERE 1=1
		<if test="subject != '' and subject != null">
    	AND		SUBJECT like concat('%',#{subject},'%')
    	</if>
		<if test="noticeTypeCd != '' and noticeTypeCd != null">
    	AND		NOTICE_TYPE_CD like concat('%',#{noticeTypeCd},'%')
    	</if>
		<if test="registFromDate != '' and registFromDate != null">
    	AND		NT.REGIST_DATE >= #{registFromDate}
    	</if>
		<if test="registToDate != '' and registToDate != null">
		<![CDATA[AND NT.REGIST_DATE <= #{registToDate}]]>
    	</if>
	</select>
 
	
	<!-- 입력 -->
	<insert id="insert" parameterType="map">
		INSERT INTO <include refid="tblnm"/>
		(
			NOTICE_SEQ,
			SUBJECT,
			CONTENTS,
			NOTICE_TYPE_CD,
			FILE_NO
			<include refid="mybatis.mapper.Base.insert_select"/>
		)
		values
		(
			${plinkName}.fn_get_seq_id('NT'),
			#{subject},
			#{contents},
			#{noticeTypeCd},
			#{fileNo}
			<include refid="mybatis.mapper.Base.insert"/>
		)
	</insert>
	
	<!-- 수정 -->
	<update id="update" parameterType="map">
		UPDATE <include refid="tblnm"/>
		SET SUBJECT = #{subject},
			CONTENTS = #{contents},
			NOTICE_TYPE_CD = #{noticeTypeCd},
			FILE_NO = #{fileNo}
			<include refid="mybatis.mapper.Base.update"/>
		WHERE NOTICE_SEQ= #{noticeSeq}
	</update>
	
	<!-- 삭제 -->
	<delete id="delete" parameterType="map">
		DELETE
		FROM <include refid="tblnm" />
		WHERE NOTICE_SEQ= #{noticeSeq}
	</delete>

</mapper>