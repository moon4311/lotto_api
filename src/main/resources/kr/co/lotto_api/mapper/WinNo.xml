<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.lotto_api.mapper.WinNo">
 
 	<sql id="tblnm">WIN_NO_TB</sql>
 	
 	<!-- 한건 조회 -->
 	<select id="selectOne" parameterType="map" resultType="kr.co.lotto_api.model.WinNoVO">
		SELECT 
					DRW_NO,
					DT,
					NO1,NO2,NO3,NO4,NO5,NO6,NO7,
					sum
		FROM 	WIN_NO_TB 
		WHERE 	DRW_NO = #{drwNo}
	</select>
	
	
 	<!-- 다건 조회 -->
 	<select id="selectList" parameterType="map" resultType="WinNoVO">
		SELECT 
			DRW_NO,
			DT,
			NO1,NO2,NO3,NO4,NO5,NO6,NO7
		FROM <include refid="tblnm" />
		ORDER BY DRW_NO DESC
		
		LIMIT ${startNo}, ${cnt}
	</select>
	
 	<!-- 각 자리별 횟수 -->
	<select id="selectBallCntPerNo" parameterType="map" resultType="BallNoVO">
		SELECT BALL_NO,
					 cnt1,
					 cnt2,
					 cnt3,
					 cnt4,
					 cnt5,
					 cnt6
		FROM ball_no_tb
	</select>
	
 	<!-- 홀짝 비율 -->
	<select id="selectOddEven" resultType="OddEvenVO">
		select 	b.*,
					 cnt0/drw_no*100 rate0,
					 cnt1/drw_no*100 rate1,
					 cnt2/drw_no*100 rate2,
					 cnt3/drw_no*100 rate3,
					 cnt4/drw_no*100 rate4,
					 cnt5/drw_no*100 rate5,
					 cnt6/drw_no*100 rate6
		FROM	(
				SELECT	  sum( case when cnt=0 then 1 else 0 end ) cnt0,
							  sum( case when cnt=1 then 1 else 0 end ) cnt1,
							  sum( case when cnt=2 then 1 else 0 end ) cnt2,
							  sum( case when cnt=3 then 1 else 0 end ) cnt3,
							  sum( case when cnt=4 then 1 else 0 end ) cnt4,
							  sum( case when cnt=5 then 1 else 0 end ) cnt5,
							  sum( case when cnt=6 then 1 else 0 end ) cnt6,
			                  count(1) drw_no
				FROM	(
							SELECT
							  		no1%2 + no2%2 + no3%2 + no4%2 + no5%2 + no6%2 cnt
							FROM WIN_NO_TB
							) a 
				) b
	</select>
	
	<select id="selectSumCnt"  resultType="SumCntVO">
		SELECT		A.SUM_NO, 
						COUNT(1) CNT,
						COUNT(1)/(SELECT count(1) FROM WIN_NO_TB )*100 RATE
		FROM (
					SELECT 	NO1+NO2+NO3+NO4+NO5+NO6 SUM_NO
					FROM 		WIN_NO_TB
		) A
		GROUP BY SUM_NO
	</select>
	
	
	
	
	
	<update id="updateBallNo">
		UPDATE ball_no_tb A 
			,(SELECT NO1 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO1 ) B1
			,(SELECT NO2 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO2 ) B2
			,(SELECT NO3 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO3 ) B3
			,(SELECT NO4 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO4 ) B4
			,(SELECT NO5 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO5 ) B5
			,(SELECT NO6 NO,COUNT(1) CNT FROM win_no_tb GROUP BY NO6 ) B6
		SET 
			CNT1 = B1.CNT,
			CNT2 = B2.CNT,
			CNT3 = B3.CNT,
			CNT4 = B4.CNT,
			CNT5 = B5.CNT,
			CNT6 = B6.CNT
		WHERE 
					A.BALL_NO = B1.NO
			AND	A.BALL_NO = B2.NO
			AND	A.BALL_NO = B3.NO
			AND	A.BALL_NO = B4.NO
			AND	A.BALL_NO = B5.NO
			AND	A.BALL_NO = B6.NO
	
	</update>
	
	
	<!-- 입력 -->
	<insert id="insert" parameterType="map">
		INSERT INTO <include refid="tblnm"/>
		(
			DRW_NO,
			DT,
			no1,
			no2,
			no3,
			no4,
			no5,
			no6,
			no7
		)
		values
		(
			#{drwNo},
			#{dt},
			#{no1},
			#{no2},
			#{no3},
			#{no4},
			#{no5},
			#{no6},
			#{no7}
		)
	</insert>
	
</mapper>