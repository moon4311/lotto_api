<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.lotto_api.mapper.WinNo">
 
 	<sql id="tblnm">WIN_NO_TB</sql>
 	
 	<!-- 한건 조회 -->
 	<select id="selectOne" parameterType="map" resultType="kr.co.lotto_api.model.WinNoVO">
		SELECT 	DRW_NO,
						DT,
						BALL_NO1,
						BALL_NO2,
						BALL_NO3,
						BALL_NO4,
						BALL_NO5,
						BALL_NO6,
						BALL_NO7,
						sum
		FROM 	WIN_NO_TB 
		WHERE 	DRW_NO = #{drwNo}
	</select>
	
	
 	<!-- 다건 조회 -->
 	<select id="selectList" parameterType="map" resultType="WinNoVO">
		SELECT 	DRW_NO,
						DT,
						BALL_NO1,
						BALL_NO2,
						BALL_NO3,
						BALL_NO4,
						BALL_NO5,
						BALL_NO6,
						BALL_NO7,
						sum
		FROM <include refid="tblnm" />
		ORDER BY DRW_NO DESC
		LIMIT ${startNo}, ${cnt}
	</select>
	
 	<!-- 각 자리별 횟수 -->
	<select id="selectBallCntPerNo" parameterType="map" resultType="BallNoVO">
		SELECT BALL_NO,
					 SEQ1_CNT,
					 SEQ2_CNT,
					 SEQ3_CNT,
					 SEQ4_CNT,
					 SEQ5_CNT,
					 SEQ6_CNT
		FROM 	ball_no_tb
	</select>
	
 	<!-- 홀짝 비율 -->
	<select id="selectOddEven" resultType="OddEvenVO">
		select 	b.*,
					 cnt0/drw_no*100 rate0,
					 cnt1/drw_no*100 rate1,
					 cnt2/drw_no*100 rate2,
					 cnt3/drw_no*100 rate3,
					 cnt4/drw_no*100 rate4,
					 cnt5/drw_no*100 rate5,
					 cnt6/drw_no*100 rate6
		FROM	(
				SELECT	  sum( case when cnt=0 then 1 else 0 end ) cnt0,
							  sum( case when cnt=1 then 1 else 0 end ) cnt1,
							  sum( case when cnt=2 then 1 else 0 end ) cnt2,
							  sum( case when cnt=3 then 1 else 0 end ) cnt3,
							  sum( case when cnt=4 then 1 else 0 end ) cnt4,
							  sum( case when cnt=5 then 1 else 0 end ) cnt5,
							  sum( case when cnt=6 then 1 else 0 end ) cnt6,
			                  count(1) drw_no
				FROM	(
							SELECT		BALL_NO1%2 
									  		+ BALL_NO2%2 
									  		+ BALL_NO3%2 
									  		+ BALL_NO4%2 
									  		+ BALL_NO5%2 
									  		+ BALL_NO6%2 	cnt
							FROM 		WIN_NO_TB
							) a 
				) b
	</select>
	
	<select id="selectSumCnt"  resultType="SumCntVO">
		SELECT		SUM_NO,
						TOTAL_CNT,
						TOTAL_RATE,
						PAST_CNT,
						case when PAST_CNT=0 then 0 else PAST_RATE end PAST_RATE 
		FROM 		SUM_NO_TB
	</select>
	
	
	
	
	<!-- 입력 -->
	<insert id="insert" parameterType="map">
		INSERT INTO <include refid="tblnm"/>
		(
			DRW_NO,
			DT,
			ball_no1,
			ball_no2,
			ball_no3,
			ball_no4,
			ball_no5,
			ball_no6,
			ball_no7,
			sum
		)
		values
		(
			#{drwNo},
			#{dt},
			#{ballNo1},
			#{ballNo2},
			#{ballNo3},
			#{ballNo4},
			#{ballNo5},
			#{ballNo6},
			#{ballNo7},
			#{sum}
		)
	</insert>
	
</mapper>